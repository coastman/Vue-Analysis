<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  
</body>
</html>
<script>
let pendig = false

const callbacks = [
  () => {
    console.log(1)
  },
  () => {
    console.log(2)
  },
  () => {
    console.log(3)
  },
  () => {
    console.log(4)
  }
]

function flushCallbacks() {
  pendig = false
  const copies = callbacks.slice(0)
  callbacks.length = 0
  for (let i = 0; i < copies.length; i++) {
    copies[i]()
  }
}
const timerFunc = () => {
  Promise.resolve().then(function flushCallbacks() {
    pendig = false
    console.log(callbacks)
    const copies = callbacks.slice(0)
    callbacks.length = 0
    for (let i = 0; i < copies.length; i++) {
      copies[i]()
    }
  })
}

function nextTick(cb, ctx) {
  callbacks.push(() => {
    cb.call(ctx)
  })

  if (!pendig) {
    pendig = true
    timerFunc()
  }
}
</script>